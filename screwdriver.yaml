shared:
    image: node:8

jobs:
    main:
        requires: [~pr, ~commit]
        steps:
            - install: npm install
            - test: npm test
            - sonar: if [ `uname` = 'Darwin' ]; then echo code coverage not implemented for ios && exit 0; fi && if ![ -f sonar-project.properties ]; then echo "No sonar-project.properties file detected. Please check the doc." && exit 0; fi && export SD_CURL_CMD_WRAPPER="$(echo 'sd-step exec --pkg-version 7.54.1 core/curl')" && export SD_UNZIP_CMD_WRAPPER="$(echo 'sd-step exec --pkg-version 6.0 core/unzip')" && $SD_CURL_CMD_WRAPPER "curl -o ./sonarscanner.zip -L https://sonarsource.bintray.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-3.1.0.1141-linux.zip" && $SD_UNZIP_CMD_WRAPPER "unzip -q ./sonarscanner.zip" && sonar-scanner-3.1.0.1141-linux/bin/sonar-scanner -Dsonar.host.url=https://sonar.screwdriver.cd -Dsonar.login=$SONAR_TOKEN -Dsonar.projectKey="job:$SD_JOB_ID" -Dsonar.projectName="$SD_PIPELINE_NAME:$SD_JOB_NAME" || true
        secrets:
            - SONAR_TOKEN
